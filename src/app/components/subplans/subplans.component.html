<div class="title-page">
  <div class="breadcrumb-container">
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        Mar Chiquita
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        Insurers
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        Coverages
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        Subplans
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </div>
  <div class="btn-container">
    <button nz-button nzType="primary" (click)="openDrawer()">
      New Subplan
    </button>
  </div>
</div>

<div class="main-table">
  <div class="table-filters">
    <!-- name -->
    <nz-input-group [nzSuffix]="suffixIconSearch">
      <input
        type="text"
        nz-input
        placeholder="Name..."
        [(ngModel)]="nameSearch"
        (ngModelChange)="search($event, 'name')"
      />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span nz-icon nzType="search"></span>
    </ng-template>
    <!-- payer id -->
    <nz-input-group [nzSuffix]="suffixIconSearch">
      <input
        type="text"
        nz-input
        placeholder="Group..."
        [(ngModel)]="groupSearch"
        (ngModelChange)="search($event, 'group')"
      />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span nz-icon nzType="search"></span>
    </ng-template>
    <!-- address -->
    <nz-input-group [nzSuffix]="suffixIconSearch">
      <input
        type="text"
        nz-input
        placeholder="Plan..."
        [(ngModel)]="planSearch"
        (ngModelChange)="search($event, 'plan')"
      />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span nz-icon nzType="search"></span>
    </ng-template>
    <!-- Phone -->
    <nz-input-group [nzSuffix]="suffixIconSearch">
      <input
        type="text"
        nz-input
        placeholder="Plan contract..."
        [(ngModel)]="planContractSearch"
        (ngModelChange)="search($event, 'planContract')"
      />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span nz-icon nzType="search"></span>
    </ng-template>
  </div>
  <nz-table
    #basicTable
    [nzData]="dataToDisplay"
    [nzFrontPagination]="false"
    [nzLoading]="isDataLoading"
  >
    <thead>
      <tr>
        <th>Plan</th>
        <th>Name</th>
        <th>Group</th>
        <th>Plan contract</th>
        <th>Visual test medicare</th>
        <th>Visual surgery medicare</th>
        <th>Routine visual test</th>
        <th>Vision element</th>
        <th>Created</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data">
        <td>{{ data.plan_data.name }}</td>
        <td>{{ data.name }}</td>
        <td>{{ data.group }}</td>
        <td>{{ data.plan_contract }}</td>
        <td>{{ data.visual_test_medicare }}</td>
        <td>{{ data.visual_surgery_medicare }}</td>
        <td>{{ data.routine_visual_test }}</td>
        <td>{{ data.vision_elements }}</td>
        <td>{{ data.created | date }}</td>
        <td>
          <a>
            <nz-switch
              title="Status"
              [(ngModel)]="data.active"
              nzSize="small"
              (ngModelChange)="changeStatus(data.id, data)"
            ></nz-switch>
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a>
            <span
              title="Edit"
              nz-icon
              nzType="edit"
              nzTheme="outline"
              (click)="openEditDrawer(data)"
            ></span>
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a>
            <span
              title="Delete"
              nz-icon
              nzType="delete"
              nzTheme="outline"
              (click)="delete(data.id)"
            ></span>
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>
  <nz-pagination
    [nzPageIndex]="page"
    [nzResponsive]="true"
    [nzTotal]="count_records"
    [nzPageSize]="page_size"
    (nzPageIndexChange)="pageChange($event)"
    nzShowQuickJumper
  ></nz-pagination>
</div>

<!-- Client drawer -->
<nz-drawer
  [nzBodyStyle]="{ overflow: 'auto' }"
  [nzMaskClosable]="false"
  [nzClosable]="false"
  [nzVisible]="visible"
  nzPlacement="right"
  [nzTitle]="drawerTitle"
  (nzOnClose)="closeDrawer()"
  [nzWidth]="720"
  [nzFooter]="footerTpl"
>
  <ng-container *nzDrawerContent>
    <nz-spin [nzSpinning]="drawerLoader">
      <form nz-form [formGroup]="form" (ngSubmit)="submit()">
        <!-- Plan -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="plan"
            style="text-align: center;"
          >
            Plan
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <nz-select
              nzShowSearch
              nzAllowClear
              id="insurer"
              nzPlaceHolder="Select a Insurer"
              formControlName="plan"
            >
              <nz-option
                *ngFor="let o of plans"
                [nzLabel]="o.name"
                [nzValue]="o.id"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <!-- Name -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="name"
            style="text-align: center;"
          >
            Name
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input nz-input formControlName="name" id="name" />
          </nz-form-control>
        </nz-form-item>
        <!-- Group -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="group"
            style="text-align: center;"
          >
            Group
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input nz-input formControlName="group" id="group" />
          </nz-form-control>
        </nz-form-item>
        <!-- Plan contract -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="plan_contract"
            style="text-align: center;"
          >
            Plan contract
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input
              nz-input
              formControlName="plan_contract"
              id="plan_contract"
            />
          </nz-form-control>
        </nz-form-item>
        <!-- visual_test_medicare -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="visual_test_medicare"
            style="text-align: center;"
          >
            Visual test medicare $
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input
              nz-input
              type="number"
              formControlName="visual_test_medicare"
              id="visual_test_medicare"
            />
          </nz-form-control>
        </nz-form-item>
        <!-- visual_surgery_medicare -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="visual_surgery_medicare"
            style="text-align: center;"
          >
            Visual surgery medicare $
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input
              nz-input
              type="number"
              formControlName="visual_surgery_medicare"
              id="visual_surgery_medicare"
            />
          </nz-form-control>
        </nz-form-item>
        <!-- routine_visual_test -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="routine_visual_test"
            style="text-align: center;"
          >
            Routine visual test $
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input
              nz-input
              type="number"
              formControlName="routine_visual_test"
              id="routine_visual_test"
            />
          </nz-form-control>
        </nz-form-item>
        <!-- vision_elements -->
        <nz-form-item>
          <nz-form-label
            [nzSm]="8"
            [nzXs]="24"
            nzFor="vision_elements"
            style="text-align: center;"
          >
            Vision element $
          </nz-form-label>
          <nz-form-control
            [nzSm]="16"
            [nzXs]="24"
            nzErrorTip="This field is required"
          >
            <input
              nz-input
              type="number"
              formControlName="vision_elements"
              id="vision_elements"
            />
          </nz-form-control>
        </nz-form-item>
      </form>
    </nz-spin>
  </ng-container>
  <ng-template #footerTpl>
    <div style="display: flex; float: right;">
      <button
        nz-button
        style="display: flex; margin-right: 8px;"
        (click)="closeDrawer()"
      >
        close
      </button>
      <button nz-button nzType="primary" (click)="submit()">Save</button>
    </div>
  </ng-template>
</nz-drawer>
